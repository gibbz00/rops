<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>&#x60;rops&#x60; Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">&#x60;rops&#x60; Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/gibbz00/rops" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<video controls>
  <source src="assets/demo.mp4" type="video/mp4" />
</video>
<p><code>rops</code> aims to make the process of handling sensitive credentials a bit more refined than simply encrypting an entire config file. It does this by allowing the encryption of sensitive values only, whilst making sure that other parts can’t be changed with malicious intent. One example use case is the remote hosting of version controlled rops-files with meaningful diff outputs. The <a href="https://github.com/getsops/sops">SOPS</a> project, (which <code>rops</code> can be seen as Rust rewrite of), contains an excellent motivation section in its <a href="https://github.com/getsops/sops/blob/main/README.rst">README</a> for those interested in further reading materials.</p>
<p>The <a href="goals.html">goals</a> chapter of this book points out some expected differences between these two projects, and the <a href="concepts.html">concepts</a> chapter takes a deeper dive into how <code>rops</code> operates. Those two chapters should serve both library and CLI users well. Remaining chapters primarily target the latter group. Library usage instructions are instead located at <a href="https://docs.rs/rops">docs.rs</a>.</p>
<p><code>rops</code> the library, the CLI application, and its documentation is free and open source under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License
Version 2.0</a>. The code can be found on <a href="https://github.com/gibbz00/rops">GitHub</a> where issues and feature requests may also be <a href="https://github.com/gibbz00/rops/issues">posted</a>. Please follow the project’s <a href="https://github.com/gibbz00/rops/blob/main/SECURITY.md">Security Policy</a> if you encounter any vulnerability. All contributions are warmly welcomed, but make sure to read the <a href="https://github.com/gibbz00/rops/blob/main/CONTRIBUTING.md">Contributing Guidelines</a> before opening a <a href="https://github.com/gibbz00/rops/pulls">pull request</a>. Feel free, however, to simply use the “Suggest an edit” button in the top right corner if you encounter any documentation errors along the way 😊</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="goals-and-non-goals"><a class="header" href="#goals-and-non-goals">Goals and Non-Goals</a></h1>
<h3 id="goals"><a class="header" href="#goals">Goals</a></h3>
<ul>
<li>Full <code>sops</code> encrypted file compatibility. Decrypt any <code>sops</code> supported format using <code>rops</code> and vice versa.</li>
<li>Be consistent in how credentials are used, set and retrieved across integrations.</li>
<li>Disincentivize unsecure operations.</li>
<li>Support standard input (stdin) as an alternative to file paths whenever possible.</li>
<li>Available as a rust library.</li>
<li>Support a wide variety of file formats and integrations.</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th>File formats</th><th>Integrations</th></tr></thead><tbody>
<tr><td>✅ YAML</td><td>✅ <code>age</code> - Asymmetric</td></tr>
<tr><td>✅ JSON</td><td>✅ <code>aws_kms</code> - Symmetric <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup></td></tr>
<tr><td>✅ TOML <sup class="footnote-reference" id="fr-2-1"><a href="#footnote-2">2</a></sup></td><td>❎<code>pgp</code> <sup class="footnote-reference" id="fr-3-1"><a href="#footnote-3">3</a></sup></td></tr>
<tr><td>❎ INI</td><td>❎<code>gcp_kms</code></td></tr>
<tr><td>❎ ENV</td><td>❎<code>azure_kv</code></td></tr>
<tr><td>❎ BINARY</td><td>❎<code>hashicorp_kv</code></td></tr>
</tbody></table>
</div>
<p>The difference between asymmetric and symmetric integrations is later explained in the <a href="concepts.html#integration-key-id">concepts chapter</a>.</p>
<h3 id="non-goals"><a class="header" href="#non-goals">Non-Goals</a></h3>
<ul>
<li>Identical CLI to <code>sops</code> with full feature parity, see <a href="goals.html#preliminary-non-goals">preliminary non-goals</a>.</li>
</ul>
<h4 id="preliminary-non-goals"><a class="header" href="#preliminary-non-goals">Preliminary Non-Goals</a></h4>
<p>This list includes a collection of SOPS features which are currently not under consideration to be included in <code>rops</code>. Nothing here is set in stone, so feel free to open up an <a href="https://github.com/gibbz00/rops/issues">issue</a> if there’s anything you don’t agree with 🙂</p>
<ul>
<li>
<p>The <code>--output</code> flag: Use <code>rops decrypt &gt; FILE_NAME</code> instead?</p>
</li>
<li>
<p>Partial retrieval: Use <code>rops decrypt FILE | jq</code> instead?</p>
</li>
<li>
<p>Partial modification:
Use <code>rops edit</code> or <code>rops decrypt FILE | jq map | rops encrypt --format FORMAT</code> instead? This will unfortunately skip initialization vector reuse of unchanged values.</p>
</li>
<li>
<p>The <code>--ignore-mac</code> flag: Deemed too insecure. <code>rops</code> files are instead encouraged to be placed under and then recovered with version control systems such as git.</p>
</li>
<li>
<p>Manual key rotation (<code>--rotate/-r</code>): <code>rops</code> will automatically rotate the secret data key upon integration key id removal.</p>
</li>
<li>
<p>Integrated formatting configuration: Might be better achieved by piping output through more powerful formatters.</p>
</li>
<li>
<p>Integrated secrets publishing: This too might be better handled externally.</p>
</li>
<li>
<p><code>rops</code> as a remote key service: Possibly as a separate crate+binary conforming to <a href="https://en.wikipedia.org/wiki/Key_Management_Interoperability_Protocol">KMIP 2.1</a> or higher.</p>
</li>
<li>
<p>Access logging: Better handled by the respective integrations for now. Might become relevant to include in the remote key service.</p>
</li>
</ul>
<h3 id="currently-missing-features"><a class="header" href="#currently-missing-features">Currently missing features</a></h3>
<ul>
<li>Sub-process secret passing.</li>
<li>Key groups.</li>
<li>Storing file comments.</li>
<li>Compute an additional MAC over active integration keys to prevent against manual removal without rotating the secret data key. (Currently not done by SOPS either.)</li>
<li>Specify keys by <code>--key-file INTEGRATION PATH</code> flag.</li>
<li>Show decrypted metadata with <code>--show-metadata/-s</code>. (Note that directly modifying the metadata will most likely break its integrity and prevent future decryption.)</li>
<li>Integration sub-features such as AWS <a href="https://github.com/getsops/sops#27kms-aws-profiles">Profiles</a>, <a href="https://github.com/getsops/sops#28assuming-roles-and-using-kms-in-various-aws-accounts">Roles</a> and <a href="https://github.com/getsops/sops#29aws-kms-encryption-context">Context</a>.</li>
</ul>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>AWS KMS effectively becomes a symmetric encryption scheme when it requires private credentials to a remote encryption service, even if that service uses asymmetric encryption internally. <a href="#fr-1-1">↩</a></p>
</li>
<li id="footnote-2">
<p><a href="https://github.com/getsops/sops/pull/812">Currently</a> exclusive to <code>rops</code>. <a href="#fr-2-1">↩</a></p>
</li>
<li id="footnote-3">
<p>Awaiting status update for: <a href="https://datatracker.ietf.org/doc/draft-ietf-openpgp-crypto-refresh/">OpenPGP Crypto Refresh</a>. <a href="#fr-3-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="concepts"><a class="header" href="#concepts">Concepts</a></h1>
<p>A <em><code>rops</code> file</em> is first created by encrypting a plaintext <em>map</em> (collection of key-value pairs) of a specified file format. The resulting <code>rops</code> file will then contain the encrypted version of the map, followed by some <code>rops</code> file metadata.</p>
<p>Only the value part of any key-value pair is encrypted. This is done using an <a href="https://en.wikipedia.org/wiki/Authenticated_encryption#Authenticated_encryption_with_associated_data">authenticated encryption with additional data</a> scheme. The secret key is a randomly generated 32 byte array called the <em>data key</em>, and the additional data is a concatenated path for key in question. Key paths as additional data is how unlawful key name changes and some forms of reorderings are protected against.</p>
<h2 id="integrations"><a class="header" href="#integrations">Integrations</a></h2>
<p>One or multiple <em>integrations</em> encrypt the data key in their own way once all values have been encrypted. The use of multiple integrations and <em>key pairs</em> within each integration add the necessary redundancy in case one integration private key is lost, or simply not present.</p>
<p>It is also how access to a <code>rops</code> file may be revoked without needing access to/knowledge of the file itself. To do so one would use an <em>identity and access management</em> (IAM) service in combination with a <em>key management service</em> (KMS) as the integration. If those services are used to encrypt and decrypt the data key, then access to the <code>rops</code> file may be revoked by removing the users’ ability to access the KMS.</p>
<h3 id="integration-key-id"><a class="header" href="#integration-key-id">Integration Key ID:</a></h3>
<p>Integration key IDs used to encrypt the data key are all stored inside the <code>rops</code> file metadata section. The key IDs also serve as a way to identify which private key is to be used when things need to be decrypted it again. If the integration relies on an asymmetric encryption scheme, then only the integration key ID is needed when the <code>rops</code> file is being created, symmetric integration require on the other hand both key id and private key up front.</p>
<p>The key IDs conform to an integration specific syntax/format, and should not be any different as a function of where it is used.</p>
<div class="table-wrapper"><table><thead><tr><th>Integration</th><th>Syntax</th><th>Example</th></tr></thead><tbody>
<tr><td>age</td><td>&lt;age_recipient&gt;</td><td><code>age1se5ghfycr4n8kcwc3qwf234ymvmr2lex2a99wh8gpfx97glwt9hqch4569</code></td></tr>
<tr><td>aws_kms</td><td><code>&lt;profile&gt;.&lt;aws_key_arn&gt;</code></td><td><code>default.arn:aws:kms:eu-north-1:822284028627:key/029dba6d-60de-4364-ac5c-cbdd284acd0a</code></td></tr>
</tbody></table>
</div>
<h3 id="private-integration-key"><a class="header" href="#private-integration-key">Private Integration Key:</a></h3>
<p>Only one private integration key that can decrypt data key needs to be found for the data key to then decrypt the entire <code>rops</code> file map. <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup> Private keys are not stored in the metadata section, but instead retrieved by iterating over the stored integration key IDs. The strategy for where to look for a private key goes as follows:</p>
<ol>
<li>In the environment variables.</li>
<li>In the <code>rops</code> key files.</li>
<li>(Future) In the default integration key files.</li>
</ol>
<p>Private integration keys follow—just like the respective key IDs—a syntax/form that is unchanged regardless of context.</p>
<div class="table-wrapper"><table><thead><tr><th>Integration</th><th>Syntax</th><th>Example</th></tr></thead><tbody>
<tr><td>age</td><td>&lt;age_secret_key&gt;</td><td><code>AGE-SECRET-KEY-1CZG0RPQJNDZWZMRMJLNYSF6H00WK0ECYAVE83ALFC2KE53WJ2FRSNZ8GC</code></td></tr>
<tr><td>aws_kms</td><td><code>&lt;profile&gt;.&lt;aws_access_key_id&gt;.&lt;aws_secret_access_key&gt;</code></td><td><code>default.AKIAXXXXXXXXXXXXXXL2.BRZXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXigu</code></td></tr>
</tbody></table>
</div>
<h5 id="to-supply-private-keys-by-environment-variables"><a class="header" href="#to-supply-private-keys-by-environment-variables">To supply private keys by environment variables</a></h5>
<p>Syntax is <code>ROPS_&lt;INTEGRATION&gt;='key1,key2'</code>. For example:</p>
<pre><code class="language-sh">export ROPS_AWS_KMS='default.AKIAXXXXXXXXXXXXXXL2.BRZXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXigu'
</code></pre>
<h5 id="to-supply-private-keys-by-rops-key-files"><a class="header" href="#to-supply-private-keys-by-rops-key-files">To supply private keys by <code>rops</code> key files</a></h5>
<p>Private keys can also be read from files, each containing a <em>new-line</em> separated list of private keys. They reside by default in <code>&lt;local_config_dir&gt;/rops/&lt;integration&gt;_keys</code>.</p>
<p><code>&lt;local_config_dir&gt;</code> varies by platform and defaults to:</p>
<div class="table-wrapper"><table><thead><tr><th>Platform</th><th>Value</th><th>Example</th></tr></thead><tbody>
<tr><td>Linux</td><td><code>$XDG_CONFIG_HOME</code> or <code>$HOME/.config</code></td><td><code>/home/alice/.config</code></td></tr>
<tr><td>macOS</td><td><code>$HOME/Library/Application Support</code></td><td><code>/Users/Alice/Library/Application Support</code></td></tr>
<tr><td>Windows</td><td><code>{FOLDERID_LocalAppData}</code></td><td><code>C:\Users\Alice\AppData\Local</code></td></tr>
</tbody></table>
</div>
<p>Linux users wishing to use the Age integration could for example save a file in <code>$HOME/.config/rops/age_keys</code> containing:</p>
<pre><code class="language-sh">AGE-SECRET-KEY-1VR0S4...KD8D
AGE-SECRET-KEY-1GQ6XJ...DZ5W
</code></pre>
<p>(As opposed to setting <code>ROPS_AGE=AGE-SECRET-KEY-1VR0S4...KD8D,AGE-SECRET-KEY-1GQ6XJ...DZ5W</code>.)</p>
<p>The <code>rops</code> key file location can be overridden by setting a <code>ROPS_&lt;INTEGRATION&gt;_KEY_FILE=&lt;path&gt;</code> environment variable. <code>ROPS_AGE_KEY_FILE=/tmp/temp_age_keys</code> for instance.</p>
<h5 id="to-supply-private-keys-using-integration-key-files-future"><a class="header" href="#to-supply-private-keys-using-integration-key-files-future">To supply private keys using integration key files (Future)</a></h5>
<p>Many integrations already store their keys in a dedicated location but in wildly different structures. <code>rops</code> does currently not parse these files, but it aims to so in the future:</p>
<div class="table-wrapper"><table><thead><tr><th>Integration</th><th>Windows</th><th>MacOS</th><th>Linux</th><th>Fallback</th><th>Format</th></tr></thead><tbody>
<tr><td>age</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td></tr>
<tr><td>aws_kms</td><td><code>%UserProfile%\.aws\credentials</code></td><td><code>$HOME/.aws/credentials</code></td><td><code>$HOME/.aws/credentials</code></td><td><code>AWS_SHARED_CREDENTIALS_FILE</code></td><td><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html#cli-configure-files-format-profile">Reference</a></td></tr>
</tbody></table>
</div>
<h4 id="private-key-rotation"><a class="header" href="#private-key-rotation">Private key rotation</a></h4>
<p>Compromised private keys can always be removed from a <code>rops</code> file. Such removals will automatically create a new data key used to re-encrypt all values. Other integration must be able to encrypt the new data key for storage when this happens. Or in other words; symmetric integration require the presence of their respective private keys during the removal of other private keys.</p>
<h2 id="partial-encryption"><a class="header" href="#partial-encryption">Partial Encryption</a></h2>
<p>All keys are encrypted by default, unless one of the <code>encrypted_suffix</code>, <code>encrypted_regex</code>, <code>unencrypted_suffix</code> or <code>unencrypted_regex</code> settings is present in the metadata:</p>
<div class="table-wrapper"><table><thead><tr><th>Variant</th><th>Encrypt by default</th><th>Matched value</th></tr></thead><tbody>
<tr><td><code>encrypted_{suffix,regex}</code></td><td>No</td><td>Is encrypted</td></tr>
<tr><td><code>unncrypted_{suffix,regex}</code></td><td>Yes</td><td>Escapes encryption</td></tr>
</tbody></table>
</div>
<p>Note that any matched key “locks” the triggered encryption config for all descendant key-value pairs.
If the metadata contains for instance <code>encrypted_suffix: "_encrypted"</code>, then the values for <code>i</code> and <code>ii</code> become encrypted as shown below:</p>
<pre><code class="language-yaml">foo: bar
nested_encrypted:
  a:
      i: encrypted
  b:
      ii: encrypted
</code></pre>
<h2 id="compute-mac-for-encrypted-values-only"><a class="header" href="#compute-mac-for-encrypted-values-only">Compute MAC for encrypted values only</a></h2>
<p>Unauthenticated plaintext value changes in a partially encrypted <code>rops</code> files will still cause subsequent decryption attempts to fail. This is because all values are hashed into a <em>message authentication code</em> (MAC). The calculation happens before any encryption, and values are read in the other they appear. MAC verification at the decryption stage will, as such, deny any unauthenticated addition, removal or reordering of unique values. (Recall how concatenated key paths as additional encryption data prevents the other class of unauthenticated reordering; equal values but with different key names).</p>
<p>The <code>mac_only_encrypted</code> metadata setting can be enabled to lift this limitation, that is; enable the direct changes to plaintext values without causing MAC mismatch errors when attempting to decrypt the rest.</p>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>Unless the unimplemented key group future is. <a href="#fr-1-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h3 id="from-cratesio"><a class="header" href="#from-cratesio">From crates.io</a></h3>
<pre><code class="language-sh"># (binary is still named rops)
cargo install rops-cli
</code></pre>
<h4 id="if-is-binary-not-found-in-path"><a class="header" href="#if-is-binary-not-found-in-path">If is binary not found in path</a></h4>
<p><code>cargo install</code> usually places binaries in its user level binary directory, default is usually being <code>$HOME/.cargo/bin</code> on Unix systems.
Make sure that it’s in your <code>$PATH</code> by appending the following to your shell startup scripts, if applicable:</p>
<pre><code class="language-sh">export PATH="$HOME/.cargo/bin:$PATH"
</code></pre>
<p>Or for those that have manually set <code>$CARGO_HOME</code>:</p>
<pre><code class="language-sh"># export CARGO_HOME="$XDG_DATA_HOME"/cargo
export PATH="$CARGO_HOME/bin:$PATH"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cli-reference"><a class="header" href="#cli-reference">CLI Reference</a></h1>
<pre><code class="language-text">Usage: rops &lt;COMMAND&gt;

Commands:
  encrypt  Encrypt plaintext maps [aliases: e]
  decrypt  Decrypt rops files [aliases: d]
  edit     Edit an encrypted rops file using $EDITOR. (Fallbacks to vim then nano and lastly vi.) Outputs to stdout if input is piped
  keys     Manage encrypted rops file keys [aliases: k]
  refresh  Make a config the single source of configuration truth for an encrypted rops file
  help     Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="encrypt-subcommand"><a class="header" href="#encrypt-subcommand">Encrypt subcommand</a></h1>
<pre><code class="language-text">Encrypt plaintext maps

Usage: rops encrypt [OPTIONS] [FILE]

Arguments:
  [FILE]  Input may alternatively be supplied through stdin

Options:
  -c, --config &lt;PATH&gt;                Read config from provided path
  -i, --in-place                     Encrypt file in place rather than printing the result to stdout
      --age &lt;AGE&gt;                    Space separated list of public age keys
      --aws-kms &lt;AWS_KMS&gt;            Space separated list of AWS KMS rops key id strings
      --encrypted-regex &lt;REGEX&gt;      Encrypt values matching key regex
      --encrypted-suffix &lt;STRING&gt;    Encrypt values matching key suffix
      --unencrypted-regex &lt;REGEX&gt;    Skip encrypting values matching key regex
      --unencrypted-suffix &lt;STRING&gt;  Skip encrypting values matching key suffix
      --mac-only-encrypted           Requires a partial encryption setting
  -f, --format &lt;FORMAT&gt;              Required if no file argument is found to infer by extension [possible values: yaml, json, toml]
  -h, --help                         Print help
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="decrypt-subcommand"><a class="header" href="#decrypt-subcommand">Decrypt subcommand</a></h1>
<pre><code class="language-text">Decrypt rops files

Usage: rops decrypt [OPTIONS] [FILE]

Arguments:
  [FILE]  Input may alternatively be supplied through stdin

Options:
  -c, --config &lt;PATH&gt;    Read config from provided path
  -i, --in-place         Decrypt file in place rather than printing the result to stdout, metadata excluded
  -f, --format &lt;FORMAT&gt;  Required if no file argument is found to infer by extension [possible values: yaml, json, toml]
  -h, --help             Print help
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="edit-subcommand"><a class="header" href="#edit-subcommand">Edit subcommand</a></h1>
<pre><code class="language-text">Edit an encrypted rops file using $EDITOR. (Fallbacks to vim then nano and lastly vi.) Outputs to stdout if input is piped

Usage: rops edit [OPTIONS] [FILE]

Arguments:
  [FILE]  Input may alternatively be supplied through stdin

Options:
  -c, --config &lt;PATH&gt;    Read config from provided path
  -f, --format &lt;FORMAT&gt;  Required if no file argument is found to infer by extension [possible values: yaml, json, toml]
  -h, --help             Print help
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="keys-subcommand"><a class="header" href="#keys-subcommand">Keys subcommand</a></h1>
<pre><code class="language-text">Manage encrypted rops file keys

Usage: rops keys &lt;COMMAND&gt;

Commands:
  add     Add integration key IDs to an encrypted rops file
  remove  Remove intregration key IDs of an encrypted rops file and rotate the data key
  help    Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="refresh-subcommand"><a class="header" href="#refresh-subcommand">Refresh subcommand</a></h1>
<pre><code class="language-text">Make a config the single source of configuration truth for an encrypted rops file

Usage: rops refresh [OPTIONS] [FILE]

Arguments:
  [FILE]  Input may alternatively be supplied through stdin

Options:
  -c, --config &lt;PATH&gt;    Read config from provided path
  -i, --in-place         Refresh the file in place rather than printing the result to stdout
  -f, --format &lt;FORMAT&gt;  Required if no file argument is found to infer by extension [possible values: yaml, json, toml]
  -h, --help             Print help
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cli-configuration"><a class="header" href="#cli-configuration">CLI Configuration</a></h1>
<p>A CLI config file can be used with so-called <em>creation rules</em>. These rules allow metadata settings to be provided “automatically”, opposed repetitively including them as CLI flags.</p>
<p>Each creation rule has a <em>path regex</em> that file names are matched against. They’re read in the order they appear, and the first match of any lookup cancels the next. (So there’s no concept of creation rule merging.)</p>
<p>Stdin content can be matched with a creation rule that captures the pseudo file name of an empty string. The <code>.*</code> path regex can therefore be used as a general fallback for both input sources.</p>
<p><code>rops</code> uses the following config file look up strategy:</p>
<ol>
<li><code>--config/-c &lt;FILE&gt;</code> flag.</li>
<li>File path set by the environment variable <code>$ROPS_CONFIG</code>.</li>
<li>File of the name <code>.rops.toml</code> found in the current working directory or any ancestor thereof.</li>
</ol>
<pre><code class="language-toml"># [[creation_rules]]
# path_regex = "&lt;REGEX&gt;"
# # Optional: Defaults to false if not set.
# mac_only_encrypted = false
# # Optional: Defaults to nothing unless set.
# # Variant may be one of:
# # - encrypted_suffix
# # - encrypted_regex
# # - unencrypted_suffix
# # - unencrypted_regex
# partial_encryption.&lt;variant&gt; = ""
# # Opional: The arrays of key IDs for each integration
# # are also optional and default to being empty.
# [creation_rules.integration_keys]
# age = ["&lt;Age Key ID&gt;"]
# aws_kms = ["&lt;AWS KMS KeyID&gt;"]

# Example:
[[creation_rules]]
path_regex = "testing/**"
mac_only_encrypted = true
partial_encryption.unencrypted_regex = "config"
integration_keys.age = [
  "age1se5ghfycr4n8kcwc3qwf234ymvmr2lex2a99wh8gpfx97glwt9hqch4569",
]

[[creation_rules]]
path_regex = "production/**"
mac_only_encrypted = false
partial_encryption.unencrypted_regex = "config"
integration_keys.age = [
  "age1qazf43xll4ramx3wcn7h2yl9scycxdhrwge8862vv6zj97pafdvq0d5mn6",
]

[[creation_rules]]
path_regex = ".*"
partial_encryption.encrypted_regex = "pass|token"
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
